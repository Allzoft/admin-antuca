<div class="w-full flex flex-column gap-3 mt-2 md:mt-0">
  <div class="flex flex-column md:flex-row w-full gap-3 md:gap-5">
    <div class="flex flex-column gap-2 w-full">
      <label for="client">Cliente <i class="pi pi-user mx-1"></i> </label>
      <p-dropdown
        id="client"
        type="text"
        [(ngModel)]="order.client"
        placeholder="Seleccione al cliente"
        [filter]="true"
        filterPlaceholder="Busca al cliente"
        emptyFilterMessage="No se encontró al cliente"
        filterBy="name,lastname"
        [filterFields]="['name','lastname']"
        [resetFilterOnHide]="true"
        [options]="clients()"
        [styleClass]="!order.client || inputDirt.client ? 'p-inputtext-sm w-full border-red-200' : 'p-inputtext-sm w-full'"
      >
        <ng-template pTemplate="selectedItem">
          <div class="flex align-items-center gap-2" *ngIf="order.client">
            <div>{{ order.client!.name }} {{ order.client!.lastname }}</div>
          </div>
        </ng-template>
        <ng-template let-client pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ client.name }} {{ client.lastname }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>

    <div class="flex flex-column gap-2 w-full">
      <label for="customer"
        >Vendedor <i class="pi pi-user-plus mx-1"></i
      ></label>
      <p-dropdown
        id="customer"
        type="text"
        [(ngModel)]="order.customer"
        [options]="customers()"
        placeholder="Seleccione al Vendedor"
        [disabled]="customerService.customer()!.name !== 'Administrador'"
        [styleClass]="!order.customer || inputDirt.customer ? 'p-inputtext-sm w-full border-red-200' : 'p-inputtext-sm w-full'"
      >
        <ng-template pTemplate="selectedItem">
          <div class="flex align-items-center gap-2" *ngIf="order.customer">
            <div>{{ order.customer!.name }} {{ order.customer!.lastname }}</div>
          </div>
        </ng-template>
        <ng-template let-customer pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ customer.name }} {{ customer.lastname }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
  </div>
  <div class="flex flex-column gap-2 w-full">
    <label for="username"
      >Notas importantes sobre la orden: <i class="pi pi-pencil mx-1"></i
    ></label>
    <textarea
      rows="2"
      cols="30"
      placeholder="Escriba acá cada las indicaciones importantes porfavor"
      pInputTextarea
      [(ngModel)]="order.notes"
      [autoResize]="true"
      class="w-full text-sm"
      [ngClass]="{'ng-invalid ng-dirty': order.notes.length === 0}"
    ></textarea>
  </div>
  <div class="flex flex-column md:flex-row w-full gap-3 md:gap-5">
    <div class="flex flex-column w-full gap-2">
      <label for="state">Estado <i class="pi pi-tag mx-1"></i></label>
      <p-dropdown
        inputId="state"
        [(ngModel)]="order.state"
        placeholder="Seleccione el estado de la orden"
        [options]="states"
        optionLabel="name"
        [styleClass]="!order.state || inputDirt.state ? 'p-inputtext-sm w-full border-red-200' : 'p-inputtext-sm w-full'"
      >
        <ng-template pTemplate="selectedItem">
          <div class="flex align-items-center gap-2" *ngIf="order.state">
            <div class="flex align-items-center gap-2">
              <p-badge
                value="."
                [severity]="order.state.color"
                styleClass="text-black-alpha-10"
              />
              {{ order.state.name }}
            </div>
          </div>
        </ng-template>
        <ng-template let-state pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div class="flex align-items-center gap-2">
              <p-badge
                styleClass="text-black-alpha-10"
                value="."
                [severity]="state.color"
              />
              {{ state.name }}
            </div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
    <div class="flex flex-column w-full gap-2">
      <label for="service_mode">
        Tipo de servicio <i class="pi pi-sign-out mx-1"></i
      ></label>

      <div
        class="flex gap-2 w-full justify-content-around md:justify-content-between"
      >
        @for (serviceMode of serviceModes; track $index) {
        <p-button
          [label]="serviceMode.label"
          [severity]="serviceMode.label !== 'Para llevar' ? 'warning':''"
          [outlined]="!serviceMode.isSelect"
          size="small"
          (onClick)="selectServiceMode($index)"
        ></p-button>
        }
      </div>
    </div>
  </div>
  <div class="flex flex-column md:flex-row gap-4 md:gap-2 w-full">
    <div class="flex flex-column w-full gap-2">
      @if (order.orderItems) {

      <label for="state"
        >Platos disponibles <i class="pi pi-verified mx-1"></i>
        <p-button
          [icon]="showAllItems ? 'pi pi-eye text-xs':'pi pi-plus text-xs'"
          styleClass="ml-1"
          severity="help"
          [style]="{ 'width.px': 18, 'height.px': 18, 'padding.px': 0, 'margin-bottom.px': 2 }"
          [outlined]="!showAllItems"
          (onClick)="showAllItems = !showAllItems"
          [rounded]="true"
        ></p-button>
      </label>
      }@else {
      <label for="state"
        >Platos disponibles <i class="pi pi-verified mx-1"></i
      ></label>
      }
      <div class="flex flex-column gap-2">
        <p-carousel
          [value]="!showAllItems ? itemsAvailable : itemsService.items() "
          [numVisible]="2"
          [showIndicators]="false"
          [showNavigators]="!layoutService.isMobile()"
          orientation="vertical"
          verticalViewPortHeight="175px"
          [numScroll]="1"
        >
          <ng-template let-item pTemplate="item">
            <div
              class="transition-colors transition-duration-500 hover:bg-bluegray-800 h-5rem w-full border-300 border-1 border-round-md flex p-2 gap-3 cursor-pointer"
              (click)="order.orderItems ? addUpdateItem(item) : addItem(item)"
            >
              <div
                class="ml-2 w-4rem h-4rem border-circle flex justify-content-center align-items-center"
              >
                <svg
                  fill="#fff"
                  version="1.1"
                  id="Capa_1"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  viewBox="0 0 56.999 56.999"
                  xml:space="preserve"
                >
                  <g>
                    <path
                      d="M56.784,40.046C56.452,39.4,55.795,39,55.069,39h-1.095c-0.464-12.195-9.362-22.26-21.017-24.52
             C32.974,14.319,33,14.159,33,14c0-2.757-2.243-5-5-5s-5,2.243-5,5c0,0.159,0.025,0.32,0.043,0.48
             C11.387,16.739,2.489,26.805,2.025,39H1.93c-0.726,0-1.383,0.4-1.715,1.046s-0.276,1.413,0.146,2.004l2.26,3.164
             C3.867,46.959,5.891,48,8.034,48h40.932c2.143,0,4.167-1.041,5.413-2.786l2.261-3.164C57.061,41.459,57.116,40.691,56.784,40.046z
              M25.006,14.172C25.002,14.114,25,14.056,25,14c0-1.654,1.346-3,3-3s3,1.346,3,3c0,0.057-0.002,0.114-0.006,0.172
             c-0.047-0.005-0.094-0.007-0.14-0.012c-0.344-0.038-0.69-0.065-1.038-0.089c-0.128-0.009-0.255-0.022-0.383-0.029
             C28.957,14.015,28.48,14,28,14s-0.958,0.015-1.432,0.041c-0.128,0.007-0.255,0.02-0.383,0.029
             c-0.348,0.024-0.694,0.052-1.038,0.089C25.1,14.165,25.053,14.166,25.006,14.172z M24.406,16.269
             c0.535-0.08,1.075-0.138,1.615-0.182c0.11-0.009,0.22-0.017,0.33-0.024c1.098-0.074,2.201-0.074,3.299,0
             c0.11,0.008,0.22,0.016,0.33,0.024c0.54,0.044,1.079,0.102,1.615,0.182C42.806,17.96,51.503,27.437,51.979,39H4.02
             C4.497,27.437,13.193,17.96,24.406,16.269z M52.751,44.051C51.879,45.271,50.464,46,48.965,46H8.034
             c-1.499,0-2.914-0.729-3.786-1.948L2.068,41H54h0.931L52.751,44.051z"
                    />
                    <path
                      d="M27.986,18c-1.643,0-3.278,0.181-4.86,0.537c-0.539,0.121-0.877,0.656-0.756,1.195c0.105,0.465,0.518,0.78,0.975,0.78
             c0.073,0,0.147-0.008,0.221-0.024C25.004,20.164,26.491,20,27.986,20c0.004,0,0.008,0,0.013,0h0c0.552,0,1-0.447,1-0.999
             C29,18.444,28.556,17.981,27.986,18z"
                    />
                    <path
                      d="M17.15,20.899C11.946,23.982,8.158,29.56,7.016,35.82c-0.099,0.544,0.261,1.064,0.805,1.163
             C7.881,36.995,7.941,37,8.001,37c0.474,0,0.895-0.338,0.983-0.82c1.039-5.698,4.473-10.768,9.186-13.56
             c0.475-0.281,0.632-0.895,0.351-1.37C18.238,20.775,17.626,20.618,17.15,20.899z"
                    />
                  </g>
                </svg>
              </div>
              <div
                class="flex flex-column align-items-start justify-content-center w-full gap-2"
              >
                <div class="text-md font-semibold">{{ item.name }}</div>
                <span class="flex align-items-center gap-2">
                  <i class="pi pi-tag text-400"></i>
                  @if (item.type_item === 0) {
                  <span class="font-semibold text-sm text-400"
                    >Sopa o entrante</span
                  >
                  } @if (item.type_item === 1) {
                  <span class="font-semibold text-sm text-400">Segundo</span>
                  } @if (item.type_item === 2) {
                  <span class="font-semibold text-sm text-400">Otro</span>
                  }
                </span>
              </div>
            </div>
          </ng-template>
        </p-carousel>
      </div>
    </div>
    <div class="flex flex-column w-full gap-2">
      <label for="service_mode">
        Platos seleccionados <i class="pi pi-shopping-cart mx-1"></i
      ></label>
      @if (order.orderItems) {
      <p-table
        [value]="order.orderItems"
        [styleClass]="order.orderItems.length === 0 ?  'p-datatable-sm md:p-datatable-md border-red-200 border-1 border-round-lg p-1':'p-datatable-sm md:p-datatable-md p-1'"
        [rowHover]="true"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="text-sm font-normal">Nombre</th>
            <th class="text-sm font-normal">Cantidad</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr class="cursor-pointer" (click)="removeUpdateItem(item)">
            <td>{{ item.item.name }}</td>
            <td class="text-center">{{ item.quantity }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="summary">
          <div class="flex align-items-center justify-content-end">
            <span
              >Precio total: @if (editTotal) {
              <input
                pInputText
                type="number"
                [(ngModel)]="order.total_amount"
                class="p-inputtext-sm w-6 text-right"
              />
              <p-button
                icon="pi pi-check font-semibold"
                (click)="editTotal=!editTotal"
                [rounded]="true"
                severity="success"
                styleClass="h-2rem w-2rem ml-2 mb-1"
              ></p-button>
              } @else {
              <p-badge
                [value]="'Bs. ' + order.total_amount.toString()"
                severity="info"
                styleClass="cursor-pointer"
                size="large"
                (click)="editTotal=!editTotal"
              />}</span
            >
          </div>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="2" class="text-sm text-300">
              No hay platos seleccionados
            </td>
          </tr>
        </ng-template>
      </p-table>
      } @else {
      <p-table
        [value]="selectItems"
        [styleClass]="selectItems.length === 0 ?  'p-datatable-sm md:p-datatable-md border-red-200 border-1 border-round-lg p-1':'p-datatable-sm md:p-datatable-md p-1'"
        [rowHover]="true"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="text-sm font-normal">Nombre</th>
            <th class="text-sm font-normal">Cantidad</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr class="cursor-pointer" (click)="removeItem(item)">
            <td>{{ item.name }}</td>
            <td class="text-center">{{ item.quantity }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="summary">
          <div class="flex align-items-center justify-content-end">
            <span
              >Precio total: @if (editTotal) {
              <input
                pInputText
                type="number"
                [(ngModel)]="order.total_amount"
                class="p-inputtext-sm w-6 text-right"
              />
              <p-button
                icon="pi pi-check"
                (click)="editTotal=!editTotal"
                [rounded]="true"
                severity="success"
                styleClass="h-2rem w-2rem ml-2 mb-1"
              ></p-button>
              } @else {
              <p-badge
                [value]="'Bs. ' + order.total_amount.toString()"
                severity="info"
                styleClass="cursor-pointer"
                size="large"
                (click)="editTotal=!editTotal"
              />}</span
            >
          </div>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="2" class="text-sm text-300">
              No hay platos seleccionados
            </td>
          </tr>
        </ng-template>
      </p-table>
      }
    </div>
  </div>
  <div class="w-full justify-content-end">
    <p-button
      styleClass="w-full"
      [label]="config.data ? 'Actualizar orden' : 'Crear orden'"
      severity="success"
      (onClick)="config.data ? updateOrder() : createOrder()"
      [disabled]="config.data?.disabled ? true : false"
      size="small"
    ></p-button>
  </div>
</div>
