<div class="flex flex-column gap-2">
  <div class="flex flex-column md:flex-row justify-content-between gap-3">
    <div
      class="flex justify-content-around w-full md:justify-content-start md:w-auto gap-2"
    >
      <p-button
        icon="pi pi-refresh text-xl"
        severity="success"
        [rounded]="true"
        [outlined]="true"
        (onClick)="refreshData()"
      ></p-button>
      <p-button
        icon="pi pi-user-plus text-xl"
        severity="help"
        [rounded]="true"
        [outlined]="true"
        (onClick)="createClient()"
      ></p-button>
      <p-button
        icon="pi pi-cart-plus text-xl"
        severity="warning"
        [outlined]="true"
        [rounded]="true"
        (onClick)="createOrder()"
      ></p-button>
      <p-button
        icon="pi pi-filter text-xl"
        severity="info"
        [outlined]="true"
        [rounded]="true"
        (click)="op.toggle($event)"
      ></p-button>
      <p-button
        icon="pi pi-filter-slash text-xl"
        severity="danger"
        [outlined]="true"
        [rounded]="true"
        (onClick)="cleanFilter()"
      ></p-button>
    </div>
    <span class="p-input-icon-right w-full md:w-auto">
      <i
        class="pi z-2"
        [ngClass]="loadingOrder ? 'pi-spin pi-spinner text-xl' : 'pi-search'"
      ></i>
      <p-calendar
        [(ngModel)]="date"
        dateFormat="yy-mm-dd"
        [monthNavigator]="true"
        [yearNavigator]="true"
        yearRange="2010:2030"
        styleClass="w-full md:w-auto"
        inputStyleClass="w-full md:w-auto"
        (onSelect)="searchByDate($event)"
      />
    </span>
  </div>
  <p-card>
    <div class="grid flex-nowrap overflow-x-scroll grid-nogutter -my-4">
      @for (order of orders(); track $index) {

      <div class="relative col-12 md:col-3 p-2">
        <div class="p-4 border-1 surface-border bg-white-alpha-10 border-round">
          <div
            class="flex flex-column align-items-center justify-content-center gap-2"
          >
            <span
              class="flex align-items-center gap-2 cursor-pointer hover:text-bluegray-400 text-center"
              (click)="showClient(order.client!)"
            >
              <i class="pi pi-user"></i>
              <span class="font-semibold">
                {{ order.client!.name }} {{ order.client!.lastname }}</span
              >
            </span>
            <p-tag
              [value]="order.state!.name"
              [severity]="order.state!.color"
            ></p-tag>
          </div>
          <div class="flex flex-column align-items-center gap-3 p-3">
            @for (item of order.orderItems; track $index) {
            <div class="flex w-full gap-2">
              <span class="font-semibold">{{ item.quantity }}</span>
              <span
                class="hover:text-bluegray-300 cursor-pointer"
                (click)="showItem(item.item)"
                >{{ item.item.name }}</span
              >
            </div>
            } @empty {
            <p>Sin items del menú</p>
            }
          </div>
          <div class="flex flex-column align-items-center gap-3 py-1">
            <div class="text-xl text-orange-400 font-bold">
              {{ order.service_mode.toUpperCase() }}
            </div>
          </div>
          <div class="flex align-items-center justify-content-center mt-2">
            <span class="text-2xl font-semibold"
              >{{ 'Bs. ' + order.total_amount }}</span
            >
          </div>
        </div>
        <div class="absolute flex left-0 top-0 mt-3 ml-3">
          <p-button
            #btn
            icon="pi pi-ellipsis-v text-white"
            severity="warning"
            [rounded]="true"
            [text]="true"
            styleClass="h-2rem w-2rem"
            (onClick)="menu.toggle($event)"
            (onClick)="selectOptionOrder(order)"
          ></p-button>
          <p-tieredMenu
            #menu
            [model]="items"
            [popup]="true"
            styleClass="absolute flex left-0 top-0 mt-3 mr-8 w-7rem"
          ></p-tieredMenu>
        </div>
      </div>
      } @empty {
      <p>Sin ventas por ahora :D</p>
      }
    </div>
  </p-card>
  <span class="text-3xl font-bold mt-2">Platos disponibles del día</span>
  <div class="grid col-12">
    @for (item of menuItems; track $index) {
    <p-card class="col-6 md:col-3 flex flex-column relative">
      <span class="flex justify-content-center -mt-4">{{item.item!.name}}</span>
      <div class="w-full flex justify-content-center">
        <img [src]="item.item?.photo | item" alt="item-image" class="w-8" />
      </div>
      <span class="flex justify-content-center font-semibold text-xl -mb-3"
        >{{getItemSales(item)}}/{{item.quantity}}</span
      >
      <p-button
        icon="pi pi-times"
        [text]="true"
        [rounded]="true"
        styleClass="absolute h-2rem w-2rem top-0 right-0 mt-2 mr-2 text-400"
        (onClick)="removeMenuItem(item)"
      ></p-button>
    </p-card>
    } @empty {
    <p-card> <h2>No encontramos platos para el día :c</h2></p-card>
    }
  </div>
  <div class="grid col-12">
    <p-card
      class="col-12 md:col-3 flex flex-column relative"
      styleClass="h-13rem"
    >
      <div class="w-full flex justify-content-center -mt-3">
        <i class="pi pi-money-bill text-green-400 text-7xl font-light"></i>
      </div>
      <span class="w-full flex justify-content-center text-2xl mt-3"
        >Ganacia bruta</span
      >
      <span
        class="w-full flex justify-content-center text-3xl text-green-400 mt-3"
        >{{'Bs. ' + totalAmount}}</span
      >
    </p-card>
    <p-card
      class="col-12 md:col-3 flex flex-column relative"
      styleClass="h-13rem"
    >
      <div class="w-full flex justify-content-center -mt-3">
        <i class="pi pi-bolt text-blue-400 text-7xl font-light"></i>
      </div>
      <span class="w-full flex justify-content-center text-xl mt-3"
        >Cantidad de ventas</span
      >
      <span
        class="w-full flex justify-content-center text-3xl text-blue-400 mt-3"
        >{{ totalAcount}}</span
      >
    </p-card>
    <p-card
      class="col-12 md:col-3 flex flex-column relative"
      styleClass="h-13rem"
    >
      <div class="w-full flex justify-content-center -mt-3">
        <i class="pi pi-database text-red-400 text-7xl font-light"></i>
      </div>
      <span class="w-full flex justify-content-center text-2xl mt-3"
        >Stock del día</span
      >
      <span
        class="w-full flex justify-content-center text-3xl text-red-400 mt-3"
        >{{stock}}</span
      >
    </p-card>
    <p-card
      class="col-12 md:col-3 flex flex-column relative"
      styleClass="h-13rem"
    >
      <div class="w-full flex justify-content-center ">
        @for (star of feedBackStars; track $index) {
        <button
          pButton
          class="p-button-text p-button-rounded w-3rem h-3rem"
          [icon]="star.fill ? 'pi pi-star-fill text-yellow-500 text-3xl' : 'pi pi-star text-white text-3xl'"
        ></button>

        }
      </div>
      <span class="w-full flex justify-content-center text-2xl mt-3"
        >Valoraciones</span
      >
      <span
        class="w-full flex justify-content-center align-items-center text-3xl text-yellow-400 mt-3"
        ><i class="pi pi-star-fill mr-2"></i>4.5</span
      >
    </p-card>
  </div>
</div>
<p-toast position="top-center"></p-toast>
<p-confirmDialog styleClass="w-auto md:w-5" position="bottom"></p-confirmDialog>
<p-overlayPanel #op>
  <div class="flex flex-column gap-3">
    @for (filter of statesService.states(); track $index) {
    <div class="flex gap-2 align-items-center">
      <p-button
        icon="pi pi-circle"
        [severity]="filter.color"
        [rounded]="true"
        styleClass="h-2rem w-2rem"
        (onClick)="stateFilter(filter)"
      ></p-button>
      <span>{{ filter.name}}</span>
    </div>
    }
  </div>
</p-overlayPanel>
