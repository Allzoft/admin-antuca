<div class="flex justify-content-between">
  <app-title title="MenÃº" />
  <div class="flex gap-3 justify-content-center align-items-center">
    <p-button
      severity="info"
      [outlined]="true"
      [rounded]="true"
      [icon]="itemsService.loading() ? 'pi pi-spin pi-spinner font-medium text-xl' : 'pi pi-refresh font-medium text-xl'"
      size="small"
      (onClick)="refreshData()"
    ></p-button>
    <p-button
      severity="success"
      icon="pi pi-plus font-medium"
      label="Nuevo plato"
      [rounded]="true"
      styleClass="text-lg"
      (onClick)="createItem()"
    ></p-button>
  </div>
</div>
<p-card>
  <p-dataView
    #dv
    [value]="items()"
    [rows]="5"
    [paginator]="true"
    paginatorStyleClass=""
  >
    <ng-template pTemplate="header">
      <div
        class="flex flex-column md:flex-row md:justify-content-between gap-2"
      >
        <p-dropdown
          [options]="sortOptions"
          [(ngModel)]="selectSort"
          optionLabel="name"
          placeholder="Ordenar por diponibilidad"
          (onChange)="sortData($event)"
          styleClass="p-inputtext-sm w-full md:w-auto"
        >
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center gap-2" *ngIf="selectSort">
              <p-tag
                [value]="selectSort.value"
                [severity]="selectSort.severity"
              />
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center gap-2">
              <p-tag [value]="item.value" [severity]="item.severity" />
            </div>
          </ng-template>
        </p-dropdown>
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input
            pInputText
            type="text"
            placeholder="Buscar item"
            (input)="customGlobalFilter($event)"
            class="focus:border-orange-500 border-round-lg p-inputtext-sm w-full md:w-auto"
          />
        </span>
      </div>
    </ng-template>
    <ng-template pTemplate="list" let-products>
      <div class="grid grid-nogutter mt-2">
        <div class="col-12" *ngFor="let item of products; let first = first">
          <div
            class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4 border-top-1 surface-border"
            [ngClass]="{ 'border-top-1 surface-border': !first }"
          >
            <p-image
              imageClass="w-9 sm:w-16rem xl:w-10rem  shadow-2 block xl:block mx-auto border-round"
              [preview]="true"
              [src]="item.photo | item"
              [alt]="item.name"
            />
            <div
              class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-center flex-1 gap-4"
            >
              <div
                class="flex flex-column align-items-center sm:align-items-start gap-3"
              >
                <div class="text-2xl font-bold text-900">{{ item.name }}</div>
                <p-rating
                  [(ngModel)]="star"
                  [readonly]="false"
                  [cancel]="false"
                ></p-rating>
                <div class="flex align-items-center gap-3">
                  <span class="flex align-items-center gap-2">
                    <i class="pi pi-tag"></i>
                    @if (item.type_item === 0) {
                    <span class="font-semibold">Sopa o entrante</span>
                    } @if (item.type_item === 1) {
                    <span class="font-semibold">Segundo</span>
                    } @if (item.type_item === 2) {
                    <span class="font-semibold">Otro</span>
                    }
                  </span>
                  @if (item.available === 1) {
                  <p-tag value="Disponible" severity="success" />
                  } @else {
                  <p-tag value="Agotado" severity="danger" />
                  }
                </div>
              </div>
              <div
                class="flex flex-column justify-content-center align-items-center sm:align-items-end gap-3 sm:gap-2"
              >
                <span class="text-2xl font-semibold"
                  >{{ 'Bs. ' + item.price }}</span
                >
                <div class="flex gap-2">
                  <p-button
                    icon="pi pi-pencil font-medium text-xl"
                    [rounded]="true"
                    severity="warning"
                    [outlined]="true"
                    class="md:align-self-end"
                    (onClick)="showItem(item)"
                  />
                  <p-button
                    icon="pi pi-trash font-medium text-xl"
                    [rounded]="true"
                    severity="danger"
                    [outlined]="true"
                    class="md:align-self-end"
                    (onClick)="deleteItem(item)"
                  />
                  <p-button
                    icon="pi pi-eye font-medium text-xl"
                    [rounded]="true"
                    severity="help"
                    [outlined]="true"
                    class="md:align-self-end"
                    (onClick)="op.toggle($event)"
                    (onClick)="selectedItem = item"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <p colspan="6">No hay clientes registrados</p>
    </ng-template>
  </p-dataView>
</p-card>
<p-toast position="top-center"></p-toast>
<p-confirmDialog styleClass="w-auto md:w-5" position="bottom"></p-confirmDialog>
<p-overlayPanel #op>
  <div class="flex flex-column gap-3 w-full">
    <span class="text-lg font-semibold">Agregar disponilidad de item</span>
    <p-calendar
      [(ngModel)]="date"
      dateFormat="yy-mm-dd"
      [monthNavigator]="true"
      [yearNavigator]="true"
      yearRange="2010:2030"
      [showIcon]="true"
    />
    <span class="p-input-icon-right w-full md:w-auto">
      <i class="pi pi-info-circle text-xl z-2"></i>
      <p-inputNumber
        inputId="integeronly"
        [(ngModel)]="quantity"
        [inputStyleClass]="quantityDirty ? 'border-red-200 w-full': 'w-full'"
        placeholder="Cantidad"
      />
    </span>
    <p-button
      label="Crear disponilidad"
      styleClass="w-full"
      severity="success"
      (onClick)="createAvailability()"
    ></p-button>
  </div>
</p-overlayPanel>
